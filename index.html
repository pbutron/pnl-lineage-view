<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>P&L Migration â€” AWS â†’ GCP</title>
    <!-- Opcional: ayuda a que el HTML fuera de cache -->
    <meta http-equiv="Cache-Control" content="no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <style>
        :root{
          --glovo-yellow:#FFC244; --glovo-green:#00A082;
          --orange:#f59e0b; --red:#ef4444; --red-strong:#b91c1c;
          --ink:#111827; --muted:#6b7280; --border:#e5e7eb; --panel:#ffffff; --bg:#f8fafc;
          --btn:#fff; --btn-border:#ddd; --shadow:0 1px 2px rgba(0,0,0,0.06); --radius:12px;
        }
        html,body{height:100%; margin:0; color:var(--ink);
          font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Arial;
          background: radial-gradient(circle at 1px 1px, rgba(255,194,68,0.11) 1px, transparent 1px) 0 0/22px 22px, #f8fafc;
        }
        .shell{max-width:1200px;margin:0 auto;padding:16px}
        .card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
        header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;padding:12px 14px;border-radius:var(--radius);
          background:linear-gradient(180deg,#fff, #fafafa)}
        .head-left{display:flex;align-items:center;gap:12px}
        .brand{display:flex;align-items:center;gap:12px}
        .logo{width:28px;height:28px;object-fit:contain}
        .title{display:flex;flex-direction:column}
        .title h1{font-size:16px;margin:0}
        .title small{color:var(--muted)}
        .legend{display:flex;gap:8px;align-items:center;color:var(--muted);flex-wrap:wrap}
        .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 8px;border:1px solid var(--border);border-radius:8px;background:#fff}
        .dot-sm{width:10px;height:10px;border-radius:50%}
        .head-actions{display:flex;gap:8px;align-items:center}
        .lock-btn{padding:8px 10px;border-radius:8px;border:1px solid var(--btn-border);background:var(--btn);cursor:pointer;box-shadow:var(--shadow)}
        .lock-state{color:var(--muted); font-size:12px}
        .progress{margin:8px 0 12px;border:1px solid var(--border);border-radius:9999px;background:#f3f4f6;overflow:hidden;height:16px;position:relative}
        .progress .fill{height:100%;width:0%;background:var(--glovo-yellow);transition:width .25s ease, background-color .25s ease}
        .progress .fill.is-complete{animation:pulse 1.2s ease-out 1}
        .progress .label{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:12px}
        @keyframes pulse {
          0% { box-shadow: 0 0 0 0 rgba(0,160,130,0.35); }
          70%{ box-shadow: 0 0 0 18px rgba(0,160,130,0); }
          100%{ box-shadow: 0 0 0 0 rgba(0,160,130,0); }
        }
        .canvas{position:relative;height:74vh}
        .canvas .inner{position:absolute;inset:0;display:flex}
        .canvas svg{width:100%;height:100%;background:#fff;border-radius:var(--radius);border:1px solid var(--border);display:block}
        .canvas .inner::after{
          content:""; position:absolute; inset:0; pointer-events:none;
          background: var(--glovo-yellow);
          /* â¬‡â¬‡ IMPORTANTE: rutas relativas + versiÃ³n, SIN barra inicial */
          -webkit-mask: url("glovo.svg?v=6") center/320px no-repeat;
                  mask: url("glovo.svg?v=6") center/320px no-repeat;
          opacity:.12;
        }
        .fx{ position:absolute; inset:0; pointer-events:none; border-radius:var(--radius); }
        .status{margin-top:8px;color:var(--muted);font-size:12px}
        .status.ok{color:#059669} .status.err{color:#dc2626}
        footer.footer{margin-top:12px;padding:10px 12px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
        .actions{display:flex;gap:8px;flex-wrap:wrap}
        button{padding:8px 10px;border-radius:8px;border:1px solid var(--btn-border);background:var(--btn);cursor:pointer;box-shadow:var(--shadow)}
        button:hover{filter:brightness(0.98)}
        button:disabled{opacity:.5;cursor:not-allowed}
        input[type=file]{display:none}
        .drop{padding:8px 12px;border:1px dashed var(--btn-border);border-radius:10px;color:var(--muted);background:#fff}
        .drop strong{color:var(--ink)}
        .drop.disabled{opacity:.5;pointer-events:none}
        .sig { margin-top: 8px; text-align: center; color: var(--muted); font-size: 12px; padding: 6px 0; }
        .sig strong { color: var(--ink); }
        /* Modal password */
        .modal{position:fixed;inset:0;background:rgba(17,24,39,0.45);display:flex;align-items:center;justify-content:center;z-index:50}
        .hidden{display:none}
        .modal-card{background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:0 20px 40px rgba(0,0,0,0.18);padding:16px;min-width:300px}
        .modal-card h3{margin:0 0 8px 0;font-size:16px}
        .modal-card p{margin:0 0 10px 0;color:var(--muted)}
        .modal-row{display:flex;gap:8px;margin-top:8px}
        .modal-row input{flex:1;padding:8px;border:1px solid var(--border);border-radius:8px}
        .modal-row button{padding:8px 10px;border-radius:8px;border:1px solid var(--btn-border);background:#fff;cursor:pointer}
        .modal-msg{margin-top:6px;color:#dc2626;font-size:12px;height:14px}
    </style>
</head>
<body>
<div class="shell">
    <header class="card">
        <div class="head-left">
            <div class="brand">
                <!-- ruta relativa + versiÃ³n -->
                <img class="logo" src="glovo.svg?v=6" alt="Glovo" title="Glovo" onerror="this.style.display='none'">
                <div class="title">
                    <h1>P&L Migration â€” AWS â†’ GCP</h1>
                    <small>Interactive lineage tracker Â· click nodes to cycle status</small>
                </div>
            </div>
            <!-- LEYENDA -->
            <div class="legend">
                <span class="chip"><span class="dot-sm" style="background:#9CA3AF"></span>Pending</span>
                <span class="chip"><span class="dot-sm" style="background:#F97316"></span>Implemented</span>
                <span class="chip"><span class="dot-sm" style="background:#FFC244"></span>Implemented &amp; Reconciled</span>
                <span class="chip"><span class="dot-sm" style="background:#7F1D1D"></span>Blocked</span>
                <span class="chip"><span class="dot-sm" style="background:#00A082"></span>Ready (SoT)</span>
            </div>
        </div>
        <div class="head-actions">
            <span class="lock-state" id="lock-state">Read-only</span>
            <button id="lock-btn" class="lock-btn">ðŸ”’ Unlock</button>
        </div>
    </header>

    <div class="card progress" id="progress">
        <div class="fill" id="prog-fill"></div>
        <div class="label" id="prog-label">Ready (SoT) 0%</div>
    </div>

    <div class="card canvas">
        <div class="inner">
            <svg id="svg" viewBox="0 0 600 400" preserveAspectRatio="xMidYMid meet">
                <defs>
                    <!-- Sombra base para nodos -->
                    <filter id="nodeShadow" x="-20%" y="-20%" width="140%" height="140%">
                        <feDropShadow dx="0" dy="1" stdDeviation="1.2" flood-color="#000" flood-opacity="0.15"/>
                    </filter>

                    <!-- Trazo dorado para milestones -->
                    <linearGradient id="goldStroke" x1="0" y1="0" x2="1" y2="1">
                        <stop offset="0%"   stop-color="#C58F00"/>
                        <stop offset="50%"  stop-color="#FFD700"/>
                        <stop offset="100%" stop-color="#F6E27A"/>
                    </linearGradient>

                    <!-- Glow dorado para el borde del milestone -->
                    <filter id="goldGlow" x="-50%" y="-50%" width="200%" height="200%">
                        <feGaussianBlur in="SourceAlpha" stdDeviation="2.8" result="blur"/>
                        <feFlood flood-color="#FFD700" flood-opacity="1" result="gold"/>
                        <feComposite in="gold" in2="blur" operator="in" result="glow"/>
                        <feMerge>
                            <feMergeNode in="glow"/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>

                    <!-- Arrowheads por estado -->
                    <marker id="arrow-pending" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto" markerUnits="strokeWidth">
                        <path d="M0,0 L10,5 L0,10 z" fill="#9CA3AF"></path>
                    </marker>
                    <marker id="arrow-implemented" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto" markerUnits="strokeWidth">
                        <path d="M0,0 L10,5 L0,10 z" fill="#F97316"></path>
                    </marker>
                    <marker id="arrow-implemented_reconciled" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto" markerUnits="strokeWidth">
                        <path d="M0,0 L10,5 L0,10 z" fill="#FFC244"></path>
                    </marker>
                    <marker id="arrow-blocked" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto" markerUnits="strokeWidth">
                        <path d="M0,0 L10,5 L0,10 z" fill="#7F1D1D"></path>
                    </marker>
                    <marker id="arrow-ready" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto" markerUnits="strokeWidth">
                        <path d="M0,0 L10,5 L0,10 z" fill="#00A082"></path>
                    </marker>
                </defs>
                <g id="edges"></g>
                <g id="nodes"></g>
            </svg>
            <canvas id="fx" class="fx"></canvas>
        </div>
    </div>

    <div class="status" id="status">Ready.</div>

    <footer class="card footer">
        <div class="actions">
            <label id="file-label" class="drop" for="file"><strong>Upload CSV</strong> (columns: <code>domain</code>, <code>from</code>, <code>to</code>)</label>
            <input id="file" type="file" accept=".csv" />
            <button id="btn-export">Export statuses</button>
            <label id="imp-label" class="drop" for="imp" title="Import a JSON statuses file">Import statuses</label>
            <input id="imp" type="file" accept=".json" />
        </div>
        <div class="actions">
            <button id="zoom-out">âˆ’</button>
            <button id="fit">Fit</button>
            <button id="zoom-in">+</button>
            <button id="reset">Reset colors</button>
        </div>
    </footer>

    <div class="sig">
        Developed by <a href="https://github.com/pbutron" target="_blank" rel="noopener">pbutron :)</a> Â· 2025
    </div>
</div>

<!-- Modal contraseÃ±a -->
<div id="lock-modal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
        <h3>Unlock editing</h3>
        <p>Enter the password to enable changes (status, import/export, reset).</p>
        <div class="modal-row">
            <input id="lock-pass" type="password" placeholder="Password" autocomplete="current-password"/>
            <button id="lock-cancel">Cancel</button>
            <button id="lock-confirm">Unlock</button>
        </div>
        <div id="lock-msg" class="modal-msg"></div>
    </div>
</div>

<!-- versiÃ³n para romper cachÃ© -->
<script type="module" src="./src/main.js?v=6"></script>
</body>
</html>
